# ‚ú® nai3_train ‚ú®

**Translated by ChatGPT**

If you need to use images generated by nai3 to batch train your SD model, then I think you need this project.

Images generated by nai3, one-click generation, labeling, and processing scripts.

Principle 1: Randomly select txt from prompt_folder as prompts to batch generate random materials.

   Turn your labeled txt into your random prompt library!

Principle 2: Randomly extract characters from JSON to generate random characters, or generate all characters sequentially.

Note: New features are welcome, and the script is continuously being optimized.

## üíø Installation and Runtime Environment

```bash
python -m venv venv
.\venv\Scripts\activate
pip install -r requirements.txt
```

## ‚öôÔ∏è Configuration

> Open the `.env` file in this directory with a text editor like Notepad, and customize the configuration according to the comments. **Token** is required, while others can remain default.

Method to obtain token:
- Log in to your NovelAI account on the website (https://novelai.net).
- Open the console (F12) and switch to the Console tab.
- Enter the following code and press Enter:
  ```javascript
  console.log(JSON.parse(localStorage.session).auth_token)
  ```
- The output string is your authorization token.

### ‚ö†Ô∏è Some Common Errors:

500: Server congestion, an issue with NovelAI.

429: Multiple people generating images simultaneously, please check if you are the only one using it.

402: Possibly due to insufficient funds in the account or token expiration, consider switching to another account.

401: Incorrect login credentials, replace the token.

Error when saving the first image in random_characters.py: Small bug, the first save always fails, but it works fine afterwards.

## ‚ú® List of Supported Samplers

```
            "k_euler",
            "k_euler_ancestral",
            "k_dpmpp_2s_ancestral",
            "k_dpmpp_2m",
            "k_dpmpp_sde",
            "ddim_v3",
```

## ‚ú® Effects of Random Character Generation:

Image 1:

![VA}S0W4AL6_ZIV~2 (BDX5](https://github.com/wochenlong/nai3_train/assets/117965575/6bfecd63-fa7f-4b36-bef9-1e8df2eef21f)

Image 2:

![0~O)3% YX{SRSL$2VY)PTJ](https://github.com/wochenlong/nai3_train/assets/117965575/093c08fc-bf83-4d38-a282-7470bf48e316)

Image 3:

![L_ZUGFLNWQXDY~4(A4~5XK2](https://github.com/wochenlong/nai3_train/assets/117965575/711aff18-3ef7-4390-889e-c0ffc846418e)

Image 4:

![V2L6B62X60RU7((XCBMAN 9](https://github.com/wochenlong/nai3_train/assets/117965575/7b290ae4-5d77-4210-9276-519bd8afe6d6)

## ‚ú® Effects of Generated Random Materials:

Image 4:

![8R@KZV(13`(0U~25~KKQTR7](https://github.com/wochenlong/nai3_train/assets/117965575/1c5a42bf-b44e-48a6-aaab-aa5487554a42)

Image 5:

![N9 KXF41KXXB2T~CKZ2VS`M](https://github.com/wochenlong/nai3_train/assets/117965575/37e1801f-bfea-4f7c-8701-ed4047c29a28)

## ü§ó Open Source Random Prompt Libraries

Massive txt random prompt words, unzip and place them into `prompt_folder`.

I. 4K High-Quality Prompt Word Library: [Link](https://huggingface.co/datasets/windsingai/random_prompt/resolve/main/prompt_4k.zip)

Features: Manually curated, high-quality, high safety, only 2% nsfw.

Content: Mainly focusing on characters and compositions.

Source: Modified from the labeled files of Yugi's AID training set.

II. 200K High-Quality Prompt Word Library: [Link](https://huggingface.co/datasets/windsingai/random_prompt/resolve/main/prompt_20W.zip)

Features: Reverse inference from real images, large quantity, high concentration of anime/manga content, sufficiently generalized, approximately 20% nsfw.

Content: Various themes, primarily focusing on female characters considering the composition of danbooru.

Source: Batch crawled from https://danbooru.donmai.us/, modified from Ganggang's 200K training set.

## üéâ Quick Start

### 1Ô∏è‚É£ random_characters.py

Generate images of specified characters randomly/in sequence.

Principle: Read character names from JSON and generate images.

This repository includes built-in random character libraries from various popular games such as Genshin Impact, Arknights, FGO, etc.

Example:
Generate random Genshin Impact character images by reading the .\json\genshin.json file.

Structure of JSON files, using genshin.json as an example:

```
{
  "role": [
    "noelle_(genshin_impact)",
    "faruzan_(genshin_impact)",
    "character1",
    "character2",
    "character3",
    .....
  ]
}
```

### 2Ô∏è‚É£ random_prompt.py

Read random prompt word libraries to batch generate random nai3 images.

### 3Ô∏è‚É£ nai3tagger.py

Read image information and generate txt files with the same name.

### 4Ô∏è‚É£ clear.py

Remove the prefix `prefix` from txt files, binding style.

### 5Ô∏è‚É£ UTF-8.py

Remove illegal characters from txt files, such as üòÑüôÉ.

Removing illegal characters from txt files is necessary as some of these characters may cause errors during training, preventing the training script from reading the txt files.

### 6Ô∏è‚É£ cut.py

Remove watermarks from images (experimental feature).